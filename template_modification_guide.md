# Template.docx 修改指南

## 一、当前模板状态分析

### ✅ 已完成的部分
- 已添加了部分静态标签：`{{ reporting_period }}`、`{{ GWP_Value_Reference_Document }}`、`{{ posted_time }}`、`{{ evaluation_score }}`
- 模板结构完整，包含了所有必要的章节和表格

### ❌ 仍需完成的部分
1. **静态标签**：缺少 `{{ company_name }}`、`{{ report_year }}`、`{{ total_emission }}`
2. **动态表格**：表格19（减排行动列表）需要添加循环标签

## 二、详细修改步骤

### 1. 添加缺失的静态标签

#### {{ company_name }} - 公司名称
- **查找位置**：报告封面、首页标题或页眉
- **替换内容**：将具体的公司名称（如"大冶特殊钢有限公司"）替换为 `{{ company_name }}`

#### {{ report_year }} - 报告年份
- **查找位置**：报告标题（如"2024年度温室气体盘查报告"）、页眉页脚或报告正文
- **替换内容**：将具体年份（如"2024"）替换为 `{{ report_year }}`

#### {{ total_emission }} - 总排放量
- **查找位置**：报告摘要、排放总量章节或关键数据汇总部分
- **替换内容**：将具体的排放量数值（如"7,122,248.83"）替换为 `{{ total_emission }}`

### 2. 设置动态表格（表格19 - 减排行动列表）

#### 表格现状
- 位置：报告中的"减排行动列表"部分
- 结构：4行 × 4列
- 表头：`['序号', '行动项目', '项目方案', '效益']`

#### 修改步骤

1. **准备工作**
   - 打开template.docx文件
   - 导航到表格19

2. **保留表头和一行数据行**
   - 确保表格有且仅有一行表头
   - 在表头下方只保留一行数据行（删除所有其他数据行）

3. **添加循环开始标签**
   - 选中该行的第一个单元格（序号列）
   - 删除原有的"1"，输入：`{% tr for action in emission_reductions %}`

4. **替换单元格内容为变量**
   - 序号列：替换为 `{{ action.index }}`
   - 行动项目列：替换为 `{{ action.name }}`
   - 项目方案列：替换为 `{{ action.plan }}`
   - 效益列：替换为 `{{ action.benefit }}`

5. **添加循环结束标签**
   - 选中该行的最后一个单元格（效益列）
   - 在单元格内容末尾添加：`{% endtr %}`

#### 完成后的效果
表格应该如下所示：
| 序号 | 行动项目 | 项目方案 | 效益 |
|------|----------|----------|------|
| `{% tr for action in emission_reductions %}` `{{ action.index }}` | `{{ action.name }}` | `{{ action.plan }}` | `{{ action.benefit }}` `{% endtr %}` |

### 3. 可选：为其他表格添加动态循环

如果需要，也可以为表格18（温室气体排放数据）添加动态循环：

#### 表格现状
- 位置：报告中的排放数据部分
- 结构：16行 × 14列
- 表头：包含各种排放类别

#### 修改建议
- 保留表头和一行数据行
- 添加循环标签：`{% tr for emission in emission_data %}`
- 使用适当的变量名：`{{ emission.source }}`、`{{ emission.co2 }}`、`{{ emission.total }}`等
- 添加结束标签：`{% endtr %}`

## 三、修改验证

完成修改后，运行以下命令验证：

```bash
python check_template.py
```

验证结果应显示：
- ✅ 所有静态标签都已找到
- ✅ 动态表格标签设置完整

## 四、注意事项

1. **标签格式**：确保所有标签直接在Word中输入，不要复制粘贴可能包含隐藏格式的文本

2. **样式继承**：可以为标签设置字体样式（加粗、颜色等），生成的报告会自动继承这些样式

3. **变量命名**：确保模板中的变量名与Python代码中的变量名保持一致

4. **循环结构**：`{% tr for %}` 和 `{% endtr %}` 必须配对使用，且只能在表格行内使用

5. **单元格分隔**：每个变量应该放在独立的单元格中，不要在同一单元格中用|分隔

## 五、示例代码参考

修改完成后，Python代码中应该准备如下数据结构：

```python
# 减排行动数据
data = {
    'company_name': '大冶特殊钢有限公司',
    'report_year': '2024',
    'total_emission': '7,122,248.83',
    'reporting_period': '2024年1月1日至2024年12月31日',
    'emission_reductions': [
        {'index': 1, 'name': '170机组环形炉智和扁棒加热炉智能燃烧项目', 'plan': '棒材和钢管加热炉均实现智能燃烧', 'benefit': '煤气消耗降低3%，年创收140万元'},
        {'index': 2, 'name': '高炉电动鼓风机节能改造项目', 'plan': '降低高炉电动鼓风机能耗', 'benefit': '电单耗降低4kwh/km³，年可节约成本660万元'},
        {'index': 3, 'name': '265烧结环冷机节能改造项目', 'plan': '提升吨矿发电量', 'benefit': '年提升发电量930万kwh'}
    ]
}

# 使用docxtpl渲染模板
template = DocxTemplate("template.docx")
template.render(data)
template.save("final_report.docx")
```

按照以上指南修改后，模板将完全符合"所见即所得"的样式管理要求，能够支持动态数据和表格生成。